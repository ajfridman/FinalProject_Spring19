---
title: "Final Project"
author: "Andrew Edelblum, Kivalina Grove, and Ouafaa Hmaddi"
date: "5/20/2019"
output: html_document
---

```{r cleanup, include = FALSE}
library(rio)
library(tidyverse)
library(janitor)

d <- import("./MasterKickstarter.csv", setclass = "tbl_df") %>% 
  clean_names()

lower48 <- d %>% 
  select(-1:-3) %>% 
  filter(country == "USA" & county != "Non-USA" & state != "Non-USA")     # We looked at inverse of filter to see which cases were in USA == country but were also labeled as county != Non-USA. Those cases were those that were not part of the continental US
```

```{r split}
lower48_split <- lower48 %>% 
  split(paste(lower48$state))

lower48_nest <- lower48 %>%
  slice(1:100) %>%
  group_by(state) %>%
  nest()
```

```{r cumsum}
map(lower48_nest$data, ~.x %>%
      mutate(pct_backers = .x$backers_count / sum(.x$backers_count),
    pct_pledged = .x$pledged / sum(.x$pledged))) 
  
check_args <- function(data, var, val) {
  
  if(!is.data.frame(data)) {
       stop("This is a not a dataframe")
      }
    else{
      if(is.numeric(data$val) == FALSE)  {
      stop("The outcome variable is not numeric")
      }
        else {
          if(is.numeric(data$var)) {
            warning("The grouping variable is numeric")
          }
        }
    }
}



check_args(iris, Species, Sepal.Width)

summarize_oh <- function(data, var, val) {
   
      var <- enquo(var)
    val <- enquo(val)
    
  check_args(data, var, val)
  
 
    

            data %>%
        group_by(!!var) %>%
        summarize(n = length(!!val),
                  n_valid = sum(!is.na(!!val)),
                  n_miss = sum(is.na(!!val)),
                  mean = mean(!!val, na.rm = TRUE),
                  sd = sd(!!val, na.rm = TRUE),
                  min = min(!!val, na.rm = TRUE),
                  max = max(!!val, na.rm = TRUE))
          
}

summarize_oh(airquality, Month, Ozone)

summarize_oh(iris, Species, Sepal.Width)
  

lower48_nest$state
```

```{r functionadd}
check_args <- function(data, 
              group_var, 
              sum_var
              ) {
	if(!is.data.frame(data)) {
		stop("Data supplied must be of type data frame.  Data supplied is not a data frame.")
	}
	if(!is.numeric(pull(data, !!enquo(sum_var)))) {
		stop("The variable to summarize must be numeric. The variable supplied is not numeric.")
	}
	if(is.numeric(pull(data, !!enquo(group_var)))) {
		warning("Warning: the grouping variable supplied is numeric, not categorical.")
	}
}

stat_calc <- function(data, 
                      group_var, 
                      outcome_var, 
                      .funs = list(n = ~length(.),
                           n_valid = ~sum(!is.na(.)),
                           n_miss = ~sum(is.na(.)),
                           mean = ~mean(., na.rm = TRUE),
                           sd = ~sd(., na.rm = TRUE),
                           min = ~min(., na.rm = TRUE),
                           max = ~max(., na.rm = TRUE))){
  
  check_args(data, !!enquo(group_var), !!enquo(outcome_var))
  
  data %>%
		group_by(!!enquo(group_var)) %>%
		summarize_at(vars(!!enquo(outcome_var)),
		             .funs)
}
```

